const express = require('express'); const router = express.Router(); const db = require('../db'); router.get('/',(req,res)=>{ const rows = db.prepare('SELECT p.*, s.name as supplier_name FROM products p LEFT JOIN suppliers s ON p.supplier_id = s.id').all(); res.json(rows); }); router.post('/',(req,res)=>{ const { name, category, price_cents, stock, supplier_id, image_url } = req.body; const info = db.prepare('INSERT INTO products (name,category,price_cents,stock,supplier_id,image_url) VALUES (?,?,?,?,?,?)').run(name,category,price_cents,stock,supplier_id,image_url); res.json(db.prepare('SELECT * FROM products WHERE id=?').get(info.lastInsertRowid)); }); router.put('/:id',(req,res)=>{ const id=req.params.id; const { name, category, price_cents, stock, supplier_id, image_url } = req.body; db.prepare('UPDATE products SET name=?,category=?,price_cents=?,stock=?,supplier_id=?,image_url=? WHERE id=?').run(name,category,price_cents,stock,supplier_id,image_url,id); res.json(db.prepare('SELECT * FROM products WHERE id=?').get(id)); }); router.delete('/:id',(req,res)=>{ db.prepare('DELETE FROM products WHERE id=?').run(req.params.id); res.json({ deleted:true }); }); module.exports = router;
